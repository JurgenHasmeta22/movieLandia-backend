<div class="container mx-auto py-6 bg-gray-900 pt-32 pb-20 text-white">
  <section class="mb-10">
    <% if (moviesByGenre.length !== 0) { %>
    <div class="flex justify-between items-center mx-1 mb-4 pl-12 pr-12">
      <div>
        <h2 class="text-2xl font-bold">Movies of genre <%= nameGenre %></h2>
        <hr class="border-b-2 border-primary mt-1">
      </div>
      <div>
        <select id="moviesSortSelect" class="bg-gray-700 text-white rounded px-3 py-2">
          <!-- Add sorting options dynamically if needed -->
        </select>
      </div>
    </div>
    <div class="flex flex-wrap gap-6 justify-center">
      <% moviesByGenre.forEach(function(movie, index) { %>
      <%- include('../components/CardItem', { data: movie, type: 'movie' }) %>
      <% }); %>
    </div>
    <div class="pt-12">
      <div class="flex justify-center mt-4" x-data="paginationHandler('movies', <%= currentPageMovies %>, <%= pageCountMovies %>, '<%= nameGenre %>')">
        <ul class="flex list-none">
          <li>
            <button @click="prevPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === 1 }">
              <i class="fas fa-angle-double-left"></i>
            </button>
          </li>
          <li>
            <button @click="decrementPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === 1 }">
              <i class="fas fa-angle-left"></i>
            </button>
          </li>
          <template x-for="page in [...Array(pageCount).keys()].map(i => i + 1)" :key="page">
            <li>
              <button @click="goToPage(page)" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-blue-600': currentPage === page }">
                <span x-text="page" class="text-white"></span>
              </button>
            </li>
          </template>
          <li>
            <button @click="incrementPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === pageCount }">
              <i class="fas fa-angle-right"></i>
            </button>
          </li>
          <li>
            <button @click="nextPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === pageCount }">
              <i class="fas fa-angle-double-right"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>
    <% } else { %>
    <div class="flex items-center justify-center h-64">
      <h1 class="text-xl text-center">No movie found with this genre.</h1>
    </div>
    <% } %>
  </section>
  <section>
    <% if (seriesByGenre.length !== 0) { %>
    <div class="flex justify-between items-center mx-1 mb-4 pl-12 pr-12">
      <div>
        <h2 class="text-2xl font-bold">Series of genre <%= nameGenre %></h2>
        <hr class="border-b-2 border-primary mt-1">
      </div>
      <div>
        <select id="seriesSortSelect" class="bg-gray-700 text-white rounded px-3 py-2">
          <!-- Add sorting options dynamically if needed -->
        </select>
      </div>
    </div>
    <div class="flex flex-wrap gap-6 justify-center">
      <% seriesByGenre.forEach(function(serie, index) { %>
      <%- include('../components/CardItem', { data: serie, type: 'serie' }) %>
      <% }); %>
    </div>
    <div class="pt-12">
      <div class="flex justify-center mt-4" x-data="paginationHandler('series', <%= currentPageSeries %>, <%= pageCountSeries %>, '<%= nameGenre %>')">
        <ul class="flex list-none">
          <li>
            <button @click="prevPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === 1 }">
              <i class="fas fa-angle-double-left"></i>
            </button>
          </li>
          <li>
            <button @click="decrementPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === 1 }">
              <i class="fas fa-angle-left"></i>
            </button>
          </li>
          <template x-for="page in [...Array(pageCount).keys()].map(i => i + 1)" :key="page">
            <li>
              <button @click="goToPage(page)" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-blue-600': currentPage === page }">
                <span x-text="page" class="text-white"></span>
              </button>
            </li>
          </template>
          <li>
            <button @click="incrementPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === pageCount }">
              <i class="fas fa-angle-right"></i>
            </button>
          </li>
          <li>
            <button @click="nextPage()" class="px-3 py-2 mx-1 rounded-md text-white hover:bg-gray-400 hover:text-gray-800 transition duration-300 cursor-pointer" :class="{ 'bg-gray-700': currentPage === pageCount }">
              <i class="fas fa-angle-double-right"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>
    <% } else { %>
    <div class="flex items-center justify-center h-64">
      <h1 class="text-xl text-center">No series found with this genre.</h1>
    </div>
    <% } %>
  </section>
</div>

<script>
  function paginationHandler(type, currentPage, pageCount, genreName) {
    return {
      currentPage: currentPage,
      pageCount: pageCount,
      genreName: genreName,
      goToPage(page) {
        this.currentPage = page;
        this.updateUrl();
      },
      prevPage() {
        if (this.currentPage > 1) this.currentPage--;
        this.updateUrl();
      },
      decrementPage() {
        if (this.currentPage > 1) this.currentPage--;
        this.updateUrl();
      },
      incrementPage() {
        if (this.currentPage < this.pageCount) this.currentPage++;
        this.updateUrl();
      },
      nextPage() {
        if (this.currentPage < this.pageCount) this.currentPage++;
        this.updateUrl();
      },
      updateUrl() {
        const url = new URL(window.location);
        url.searchParams.set(`page${type.charAt(0).toUpperCase() + type.slice(1)}`, this.currentPage);
        window.history.pushState({}, '', url);
        window.location.reload();
      }
    }
  }
</script>